# Changelog

All notable changes to the Ahimsa AI Framework will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## 2.1.0 - 2026-02-11

### Added

#### Interactive Browser Demo
- **`demo.html`** — Self-contained HTML page that simulates the full 4-layer validation pipeline
  - Real regex patterns ported from the Python framework (keyword detection + safe context filtering)
  - Simulated semantic similarity scoring against ~60 reference harmful examples
  - Simulated OpenAI moderation API with category-level flagging
  - Simulated LLM-as-a-Judge evaluation with Ahimsa-principled reasoning
  - Animated pipeline visualization with realistic per-layer timing
  - 15 pre-loaded example inputs across three categories (blocked, safe context, edge cases)
  - Compassionate refusal message generation
  - Collapsible JSON audit log for each validation run
  - Zero dependencies — works in any browser, no server or API keys needed
  - Live version hosted via GitHub Pages

#### GitHub Pages
- Demo is now playable at `https://bissembert1618.github.io/ahimsa/demo.html`

---

## 2.0.0 - 2025-12-08

### Added

#### Multi-Layer Validation Pipeline
- **Layer 1: Context-Aware Keyword Detection**
  - Safe context patterns to reduce false positives
  - Recognizes technical terms (kill process, attack surface)
  - Recognizes slang expressions (killing it, bombed the interview)
  - Recognizes medical terms (panic attack, heart attack)

- **Layer 2: Semantic Similarity Validation**
  - Uses sentence-transformers for ML-based detection
  - Catches paraphrased harmful content
  - Configurable similarity threshold
  - Ability to add new harmful examples dynamically

- **Layer 3: External Moderation API**
  - Integration with OpenAI's moderation endpoint
  - Category-level violation detection
  - Confidence scores for each category

- **Layer 4: LLM-as-a-Judge**
  - Support for Anthropic Claude and OpenAI GPT
  - JSON-structured evaluation responses
  - Configurable model selection

#### Separate Input/Output Validation
- Different validation strategies for user requests vs AI responses
- Output validator catches harmful instructions being provided
- Context-aware output validation

#### Production-Ready Features
- Comprehensive logging with request IDs
- Audit trail with timestamps and processing times
- Graceful error handling and degradation
- Lazy initialization of expensive components

#### New Integrations
- `AhimsaClaude` - Full Anthropic Claude wrapper
- `AhimsaClaudeConversation` - Multi-turn conversation support
- `AhimsaOpenAI` - Full OpenAI wrapper
- `AhimsaOpenAIConversation` - Multi-turn conversation support
- `AhimsaOpenAIStreaming` - Streaming response support

#### Testing
- Comprehensive pytest test suite
- Tests for all validation layers
- Edge case testing (unicode, long input, whitespace)
- Fallback basic tests when pytest unavailable

#### Documentation
- Complete README rewrite with architecture diagrams
- Configuration examples
- Performance benchmarks
- Use case recommendations

### Changed

- **Breaking**: `AhimsaValidator` replaced with `AhimsaValidationPipeline`
- **Breaking**: `validate_request()` now returns `ValidationResult` object
- **Breaking**: Constructor parameters changed for `AhimsaAI`
- Refusal messages are now generated by `RefusalGenerator` class
- System prompts are now generated by `SystemPromptGenerator` class
- Improved regex patterns for harmful content detection

### Fixed

- False positives for technical terms containing "kill", "attack", "destroy"
- False positives for slang expressions
- False positives for medical terminology
- Input and output validation now use appropriate different patterns

### Removed

- Simple regex-only validation (replaced with context-aware version)
- Symmetric input/output validation (now separate)

---

## 1.0.0 - 2025-12-02

### Added

- Initial release
- Basic regex-based harmful content detection
- Simple system prompt for AI models
- Anthropic Claude integration example
- OpenAI integration example
- MIT License

### Known Issues (Fixed in 2.0.0)

- High false positive rate for technical terms
- No semantic understanding of content
- Same validation for input and output
- No logging or audit trail
- No test suite

---

## Version History Summary

| Version | Release Date | Highlights |
|---------|--------------|------------|
| 2.1.0 | 2026-02-11 | Interactive browser demo, GitHub Pages |
| 2.0.0 | 2025-12-08 | Multi-layer pipeline, semantic validation, production-ready |
| 1.0.0 | 2025-12-02 | Initial release, basic regex validation |

---

## Upgrade Guide: 1.0.0 → 2.0.0

### Breaking Changes

#### 1. Constructor Changes

**Before (v1.0.0):**
```python
ahimsa = AhimsaAI()
```

**After (v2.0.0):**
```python
ahimsa = AhimsaAI(
    enable_semantic=True,      # New option
    enable_external_api=False, # New option
    enable_llm_judge=False     # New option
)
```

#### 2. Validation Result Changes

**Before (v1.0.0):**
```python
is_valid, violations = ahimsa.validator.validate_request(text)
```

**After (v2.0.0):**
```python
result = ahimsa.pipeline.validate_input(text)
is_valid = result.is_valid
violations = result.violations
request_id = result.request_id  # New
processing_time = result.processing_time_ms  # New
```

#### 3. Process Request Return Value

**Before (v1.0.0):**
```python
result = ahimsa.process_request(user_input)
# result['violations'] was a list of AhimsaViolation objects
```

**After (v2.0.0):**
```python
result = ahimsa.process_request(user_input)
# result['validation_result'] is now a dictionary (serializable)
# Use result['validation_result']['violations'] for violation list
```

#### 4. Integration Classes

**Before (v1.0.0):**
```python
from anthropic_integration import AhimsaClaude
response = ahimsa_claude.create_message(user_message)
# Returns string
```

**After (v2.0.0):**
```python
from anthropic_integration import AhimsaClaude
result = client.create_message(user_message)
# Returns dict with 'status', 'response', 'validation', 'usage'

# For simple string response:
response = client.chat(user_message)
```

### Migration Steps

1. **Update imports** - No changes needed, same module names

2. **Update AhimsaAI initialization** - Add new parameters as needed

3. **Update result handling** - Access `validation_result` dict instead of direct violations

4. **Update integration usage** - Use new return format or `.chat()` method

5. **Run tests** - Use new test suite to verify functionality
```bash
pytest test_ahimsa_framework.py -v
```

---

## Future Releases

### Planned for v2.2.0 (moved from v2.1.0)
- Configuration file support (YAML)
- Rate limiting
- Caching for repeated requests

### Planned for v2.2.0
- Fine-tuned classifier option
- Adversarial testing suite
- Admin dashboard

### Planned for v3.0.0
- Multi-language support
- Human-in-the-loop escalation
- Plugin architecture for custom validators
